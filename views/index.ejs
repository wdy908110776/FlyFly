<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <h2 id="player"></h1>
    <h1 id="countdown"></h1>
    <h3 id='charge'></h3>
  <br>
    CHARGE
    <button id="charge" value=0>YUN</button>
  <br>
    ATTACK
    <button id="bubble" value=1>PAOPAO</button>
    <button id="copper bubble" value=2>TONGBAOBAO</button>
    <button id="iron bubble" value=3>TIEPAOPAO</button>
    <button id="gold bubble" value=4>JINPAOPAO</button>
    <button id="crystal bubble" value=5>SHUIJINGPAOPAO</button>
    <button id="diamond bubble" value=6>ZHUANSHIPAOPAO</button>
  <br>
    DEFENSE
    <button id="normal" value="=">PUFANG</button>
    <button id="super" value="==">CHAOFANG</button>
    <script>
    var host = document.location.host.replace(/:.*/, '');
    var ws = new WebSocket('ws://' + host + ':8080');
    ws.onmessage = function(event) {
      var data = JSON.parse(event.data);
      if (data.player) {
        document.querySelector('#player').innerHTML = data.player;
      }
      var countdown = document.querySelector('#countdown');
      if (data.start) {
        setTimeout(function() { countdown.innerHTML = 'Pao' }, 1000);
        setTimeout(function() { countdown.innerHTML = 'Pao' }, 3000);
        setTimeout(function() { countdown.innerHTML = 'Yun' }, 5000);
      }
      if (data.tie) {
        countdown.innerHTML = 'IT\'S A TIE';
      } else if (data.win === true) {
        countdown.innerHTML = 'YOU WIN!';
      } else if (data.win === false) {
        countdown.innerHTML = 'YOU LOSE';
      }
    }
    document.querySelector('#rock').onclick = function() {
      ws.send(JSON.stringify({ choice: 'ROCK' }));
    }
    document.querySelector('#paper').onclick = function() {
      ws.send(JSON.stringify({ choice: 'PAPER' }));
    }
    document.querySelector('#scissor').onclick = function() {
      ws.send(JSON.stringify({ choice: 'SCISSOR' }));
    }
    window.onbeforeunload = function() {
      ws.onclose = function () {};
      ws.close()
  };
    </script>
  </body>
</html>
